<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Azure-VMSS-Web-Multi-Region-MultiAZ</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <header>
      <h1>Azure-VMSS-Web-Multi-Region-MultiAZ</h1>
    </header>

    <main>
      <section>
        <h2>Overview</h2>
        <ul>
          <li>
            Terraform project provisions a highly available static website on
            Microsoft Azure.
          </li>
          <li>
            It automatically deploys a scalable, fault-tolerant web
            infrastructure that serves content directly from a public GitHub
            repository.
          </li>
          <li>
            Fully modular Terraform design separating networking, compute and
            load balancing components.
          </li>
          <li>
            Designed to be reusable and cost effective - supports rapid
            deployment across regions, zones and subscriptions.
          </li>
          <li>
            Multi-region deployment configuration using Azure paired regions for
            increased resilience and disaster recovery.
          </li>
          <li>
            Virtual Machine Scale Sets are distributed across availability zones
            where supported, providing zone-level fault tolerance.
          </li>
          <li>
            Website updates are deployed automatically through GitHub Actions on
            each push to the main branch, allowing site updates without
            redeploying infrastructure.
          </li>
          <li>
            Configuration also ensures each Linux VM is kept up to date with the
            latest system and package updates during provisioning.
          </li>
          <li>
            Fully automated CI/CD pipelines are implemented using GitHub
            Actions; Unit tests, Terraform validation, Backend Checks, Backend
            Bootstrap, Production Deployment & Destruction.
          </li>
        </ul>
      </section>

      <section>
        <h2>Features</h2>
        <ul>
          <li>
            Creates a dedicated Azure Resource Group to logically isolate all
            deployed resources.
          </li>
          <li>
            Deploys Azure Virtual Networks and subnets per region to support
            secure and scalable networking.
          </li>
          <li>
            Implements an Azure Load Balancer with a public frontend IP and
            backend pool for high availability and traffic distribution.
          </li>
          <li>
            Provisions Azure Virtual Machine Scale Sets (VMSS) across one or
            more regions for horizontal scalability.
          </li>
          <li>
            Distributes VM instances across Availability Zones where supported
            to increase fault tolerance.
          </li>
          <li>
            Automatically installs and configures Apache and Git on each Linux
            VM during initial provisioning.
          </li>
          <li>
            Clones static website content from a public GitHub repository during
            VM bootstrap using cloud-init.
          </li>
          <li>
            Keeps all VM instances up to date by applying system and package
            updates at provisioning time.
          </li>
          <li>
            Separates infrastructure deployment from application updates to
            avoid unnecessary VM or scale set redeployments.
          </li>
          <li>
            Uses GitHub Actions to automatically deploy updated website content
            to all running VMSS instances on each push to the main branch.
          </li>
          <li>
            Executes updates using Azure-native VMSS Run Command, eliminating
            the need for SSH access or public VM IPs.
          </li>
          <li>
            Supports dynamic discovery of VM Scale Sets within a resource group,
            enabling updates across multiple regions without manual
            configuration.
          </li>
          <li>
            Designed to scale to large numbers of VM Scale Sets without
            requiring additional GitHub secrets or Terraform state access.
          </li>
          <li>
            Outputs key deployment details including resource group name, VMSS
            IDs, load balancer backend pool IDs and public IP addresses.
          </li>
        </ul>
      </section>

      <section>
        <h2>Continuous Deployment – Static Site Updates</h2>
        <ul>
          <li>
            Website content is deployed initially during VM provisioning using
            cloud-init.
          </li>
          <li>
            Subsequent website updates are handled independently of
            infrastructure using GitHub Actions.
          </li>
          <li>
            When changes are pushed to the main branch—specifically within the
            Static Site directory—the website is automatically updated across
            all VM Scale Set instances.
          </li>
          <li>
            No VM redeployment, scaling event, or Terraform apply is required to
            update website content.
          </li>
          <li>
            Updates are executed using Azure VMSS Run Command, which securely
            runs update scripts on all instances without requiring public IP
            access or SSH.
          </li>
        </ul>
      </section>

      <section>
        <h2>Infrastructure Overview</h2>
        <pre>
Azure-VMSS-Web-Multi-Region-MultiAZ
└── Resource Group
    ├── Network Security Groups
    │   └── Inbound Rules
    │       ├── Allow HTTP
    │       └── Allow SSH
    │
    ├── Virtual Networks
    │   ├── VNet (Primary Region)
    │   │   └── Subnet
    │   │       └── NSG Association
    │   └── VNet (Paired Region)
    │       └── Subnet
    │           └── NSG Association
    │
    ├── Load Balancers
    │   ├── Public IP
    │   │   └── Azure Load Balancer (Primary Region)
    │   │       └── Backend Pool → VMSS (Primary)
    │   └── Public IP
    │       └── Azure Load Balancer (Paired Region)
    │           └── Backend Pool → VMSS (Paired)
    │
    ├── Virtual Machine Scale Sets
    │   ├── VMSS – Primary Region
    │   │   ├── Availability Zone 1 VM(s)
    │   │   ├── Availability Zone 2 VM(s)
    │   │   └── Availability Zone 3 VM(s)
    │   │
    │   └── VMSS – Paired Region
    │       ├── Availability Zone 1 VM(s)
    │       ├── Availability Zone 2 VM(s)
    │       └── Availability Zone 3 VM(s)
    │
    ├── Automation & CI/CD
    │   ├── GitHub Actions
    │   │   ├── Trigger: Pull requests to dev branch
    │   │   ├── Azure authentication (Service Principal)
    │   │   ├── Dynamic VMSS discovery (per Resource Group)
    │   │   └── az vmss run-command invoke
    │   │       └── Pulls latest static site content from GitHub
    │   │
    │   └── Update Script (update_site.sh)
    │       ├── Git fetch & reset to latest commit
    │       ├── Copies static site files
    │       ├── Applies permissions
    │       └── Restarts Apache
    │
    └── Static Website Content
        ├── Stored in GitHub Repository
        ├── Served directly by Apache
        └── Automatically updated on every push
        </pre>
      </section>

      <section>
        <h2>Details</h2>
        <ul>
          <li>
            Load Balancer distributes web traffic evenly across all VM
            instances.
          </li>
          <li>
            Each VM runs Apache and serves content from the GitHub repository.
          </li>
          <li>
            When a change is pushed to the GitHub repository, a GitHub Action
            automatically deploys the latest version of the site to all running
            VMs.
          </li>
          <li>
            VM Scale Set ensures scalability and high availability across
            multiple zones.
          </li>
        </ul>
      </section>

      <section>
        <h2>Automated Website Code Deployment</h2>
        <ul>
          <li>
            Terraform provisions the VMSS and installs Apache and Git using
            cloud-init.
          </li>
          <li>
            Initial website content is cloned from GitHub during VM creation.
          </li>
          <li>
            GitHub Actions workflow is triggered on every pull request targeting
            the <code>dev</code> branch, specifically for changes in the
            <code>Static-Site</code> folder:
            <ul>
              <li>
                Dynamically discovers all VM Scale Sets in the target Resource
                Group.
              </li>
              <li>
                Executes a shell script to pull the latest version of the
                repository into the web root.
              </li>
              <li>Restarts Apache to serve the new content.</li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <h2>CI/CD Workflow</h2>
        <p>
          Project includes multiple automated workflows to ensure safe, tested,
          and structured deployments. All workflows currently trigger on pull
          requests targeting the <code>dev</code> branch.
        </p>

        <h3>Workflow Sequence</h3>
        <ol>
          <li>
            <strong>Unit Tests</strong> – Validate application code and scripts.
          </li>
          <li>
            <strong>Plan Validation</strong> – Terraform plan validation to
            check for errors before apply.
          </li>
          <li>
            <strong>Backend Checks</strong> – Verify Terraform backend is
            configured and accessible.
          </li>
          <li>
            <strong>Bootstrap Backend</strong> – Creates Terraform backend in
            Azure if not already provisioned.
          </li>
          <li>
            <strong>Production Deployment</strong> – Apply infrastructure
            changes to the production environment.
          </li>
          <li>
            <strong>Production & Backend Destroy</strong> – Safely tear down
            infrastructure when required.
          </li>
        </ol>

      <section>
        <h2>Deployment Instructions</h2>
        <ol>
          <li>
            <strong>Clone this repository:</strong>
            <pre>
git clone https://github.com/Jammy-1/Azure-VMSS-Web-Multi-Region-MultiAZ
cd Azure-VMSS-Web-Multi-Region-MultiAZ/
            </pre>
          </li>
          <li>
            <strong>Configure Terraform variables:</strong>
            <pre>
resource_group_name = "rg-static-website"
location            = "UK South"
github_repo         = "https://github.com/your-org/your-repo"
github_branch       = "main"
vm_admin_username   = "azureuser"
ssh_public_key_path = "~/.ssh/id_rsa.pub"
instance_count      = 2
vm_size             = "Standard_B2s"
            </pre>
            <p>
              Only public repositories are supported for this configuration.
            </p>
          </li>
          <li>
            <strong>Initialize Terraform:</strong>
            <pre>terraform init</pre>
          </li>
          <li>
            <strong>Preview the deployment plan:</strong>
            <pre>terraform plan</pre>
          </li>
          <li>
            <strong>Deploy the infrastructure:</strong>
            <pre>terraform apply</pre>
          </li>
          <li>
            <strong>Access your website:</strong>
            <pre>terraform output public_ip</pre>
            <p>
              Open <code>http://&lt;public_ip&gt;</code> in your browser to view
              the site.
            </p>
          </li>
        </ol>
      </section>

      <section>
        <h2>Outputs</h2>
        <ul>
          <li>
            <strong>resource_group_name</strong> – Name of the deployed Resource
            Group
          </li>
          <li>
            <strong>vmss_id</strong> – The ID of the Virtual Machine Scale Set
          </li>
          <li>
            <strong>backend_address_pool_id</strong> – The Load Balancer backend
            pool ID
          </li>
          <li>
            <strong>public_ip</strong> – The public IP address of the Load
            Balancer
          </li>
        </ul>
      </section>
    </main>

    <footer>
      <p>&copy; Jammy-1 Azure-VMSS-Web-Multi-Region-MultiAZ</p>
    </footer>
  </body>
</html>
